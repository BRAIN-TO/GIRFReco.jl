<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>GIRFReco.jl Example Configuration · GIRFReco.jl Documentation</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GIRFReco.jl Documentation</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../Utilities/">API</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../joss_demo/">GIRFReco.jl Example Script</a></li><li class="is-active"><a class="tocitem" href>GIRFReco.jl Example Configuration</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Data-selector"><span>Data selector</span></a></li><li><a class="tocitem" href="#Directories-and-File-Names"><span>Directories and File Names</span></a></li><li><a class="tocitem" href="#Final-Steps"><span>Final Steps</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>GIRFReco.jl Example Configuration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>GIRFReco.jl Example Configuration</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/BRAIN-TO/GIRFReco.jl/blob/main/docs/lit/examples/recon_config_joss_demo.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="example_config"><a class="docs-heading-anchor" href="#example_config">GIRFReco.jl Example Configuration</a><a id="example_config-1"></a><a class="docs-heading-anchor-permalink" href="#example_config" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>This recon_config.jl file describes all general reconstruction parameters, as well as data locations and selections for an iterative non-Cartesian reconstruction that relies on an external reference scan (Cartesian) to estimate calibration maps (coil sensitivities, B₀ maps).</p><p>All parameters are stored in a dictionary named <code>params_general</code>.</p><pre><code class="language-julia hljs">params_general = Dict{Symbol,Any}();</code></pre><p>Gyromagnetic ratio, in unit of Hz</p><pre><code class="language-julia hljs">params_general[:gamma] = 42577478;</code></pre><p>General options for reconstruction script:</p><pre><code class="language-julia hljs">params_general[:do_load_maps] = true                 # if true, reloads B₀/SENSE maps instead of recalculating
params_general[:do_save_recon] = true                # if true, saves reconstruction and all auxiliary image data (maps) as NIfTI files
params_general[:do_plot_recon] = true                # if true, plots intermediate debugging and output recon figures (needs graphics, not recommended in multi-thread mode due to PyPlot)
params_general[:do_process_map_scan] = true          # if true, compute sensitivity and B₀ maps from reconstructed Cartesian scan
params_general[:do_save_processed_map_scan] = false  # save ISMRMD file of preprocessed Cartesian data (before recon)
params_general[:recon_id] = &quot;v7&quot;                     # unique identifier for the saved result files
params_general[:do_correct_with_b0_map] = true       # whether perform off-resonance correction
params_general[:do_correct_with_girf_k1] = true      # whether perform 1st order GIRF correction
params_general[:do_correct_with_girf_k0] = true      # whether perform 1st order GIRF correction
params_general[:do_coil_compression] = false         # whether perform coil compression
params_general[:do_normalize_recon] = false;         # if true, set the range of magnitude image as [0 1]</code></pre><p>General parameters for reconstruction:</p><pre><code class="language-julia hljs">params_general[:num_adc_samples] = 15650             # total number of ADC points BEFORE the rewinder at the end of the spiral readout. Need to check with data. # 15504 for 523, 15655 for gradient 508
params_general[:recon_size] = [200, 200, 1]          # the matrix size of the reconstructed images. Needs to specify 1 on Z dimension for 2D images
params_general[:num_recon_iterations] = 40             # number of recon iterations (for both Cartesian and Spiral recon)
params_general[:b0_map_beta] = 0.1             # for estimate_b0_maps, * `β` - Regularization parameter controlling roughness penalty (larger = smoother, default 5e-4)
params_general[:saving_scalefactor] = 1.0e9    # typical range of recon intensities is 1e-7, rescale when saving, e.g., to 0...1000 roughly for fMRI analysis
params_general[:num_virtual_coils] = 8                 # if perform coil compression, the number of coils to be compressed to
params_general[:fov_shift] = [-2, -5]               # amount of FOV shift; in unit of number of voxels in [x,y] direction (for our in-vivo dataset this is [0, -15], change as necessary)
params_general[:slice_distance_factor_percent] = 400 # Scan parameters, Additional acquisition information, e.g., slice distance etc.
params_general[:num_total_diffusion_directions] = 6;          # Need to specify total diffusion directions included in the raw data</code></pre><h2 id="Data-selector"><a class="docs-heading-anchor" href="#Data-selector">Data selector</a><a id="Data-selector-1"></a><a class="docs-heading-anchor-permalink" href="#Data-selector" title="Permalink"></a></h2><p>See details in the page Advanced Usage.</p><p>Data selector is designed for calling the script repetitively through <a href="https://github.com/BRAIN-TO/GIRFReco.jl/blob/main/recon/RunReconLoop.jl"><code>RunReconLoop.jl</code></a> for e.g. different diffusion directions and/or different averages. Note that the index of diffusion direction starts from 0 (b=0) to the total number in MDDW protocol, e.g. for 6 diffusion directions, 1-6 stands for 6 DWIs. <code>boolean is_called_from_global_recon</code> should be set as true if this <code>RunReconLoop.jl</code> is active. If is<em>called</em>from<em>global</em>recon is false or not defined, the data selector needs to be defined in the following code block.</p><pre><code class="language-julia hljs">if !(@isdefined is_called_from_global_recon) || !is_called_from_global_recon
    global selector = Dict{Symbol,Any}()
    selector[:avg] = 1
    selector[:seg] = 1
    selector[:dif] = 0;
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0</code></pre><h2 id="Directories-and-File-Names"><a class="docs-heading-anchor" href="#Directories-and-File-Names">Directories and File Names</a><a id="Directories-and-File-Names-1"></a><a class="docs-heading-anchor-permalink" href="#Directories-and-File-Names" title="Permalink"></a></h2><p>We set directories for data reading in and results writing in this section.</p><h3 id="Specifying-Directories"><a class="docs-heading-anchor" href="#Specifying-Directories">Specifying Directories</a><a id="Specifying-Directories-1"></a><a class="docs-heading-anchor-permalink" href="#Specifying-Directories" title="Permalink"></a></h3><pre><code class="language- hljs">params_general[:project_path] = root_project_path # Root path for the project

#Path to ISMRMRD files (raw k-space data) [Input]
params_general[:data_path] = params_general[:project_path]
#Path to spiral readout gradient files [Input]
params_general[:gradients_path] = joinpath(params_general[:project_path], &quot;Gradients&quot;)
#Path to GIRF files [Input]
params_general[:girf_path] = joinpath(params_general[:project_path], &quot;GIRF&quot;, &quot;GIRF_ISMRM2022&quot;)
#Path to middle results (coil and B₀ maps) files [Output]
params_general[:results_path] = joinpath(params_general[:project_path], &quot;results&quot;, &quot;phantom&quot;)
#Path to final reconstructed spiral images [Output]
params_general[:recon_save_path] = joinpath(params_general[:results_path], &quot;recon&quot;, params_general[:recon_id]);
nothing #hide</code></pre><h3 id="Specifying-File-Names"><a class="docs-heading-anchor" href="#Specifying-File-Names">Specifying File Names</a><a id="Specifying-File-Names-1"></a><a class="docs-heading-anchor-permalink" href="#Specifying-File-Names" title="Permalink"></a></h3><pre><code class="language-julia hljs">params_general[:map_scan_filename] = &quot;Fieldmaps/meas_MID00083_FID06181_GRE_FieldMap_DualEcho_2mm.mrd&quot; # Cartesian dual-echo file, for coil and B₀ maps calculation [Input]
params_general[:map_scan_filename_stem] = &quot;meas_MID00083_FID06181_GRE_FieldMap_DualEcho_2mm.mrd&quot;
params_general[:girf_filename] = [&quot;2021Nov_PosNeg_Gx.mat&quot;, &quot;2021Nov_PosNeg_Gy.mat&quot;, &quot;2021Nov_PosNeg_Gz.mat&quot;] # Calculated GIRF for each gradient axis [Input]
params_general[:gradient_filename] = joinpath(&quot;gradients508.txt&quot;); # File name for the spiral gradient [Input]</code></pre><p>Select here if you want to use the first spiral interleave or all 4 interleaves for reconstruction. We are selecting the first interleave as demo. If you want a multi-interleave spiral reconstruction, remove the comment mark on the 2nd line.</p><pre><code class="language-julia hljs">params_general[:scan_filename] = [&quot;Spirals/meas_MID00072_FID06170_diffSpiral_508_Intl0_b2k_4Avg.mrd&quot;] # ISMRMRD Raw k-space data for spiral acquisition [Input]
#params_general[:scan_filename] = [&quot;Spirals/meas_MID00072_FID06170_diffSpiral_508_Intl0_b2k_4Avg.mrd&quot;,&quot;Spirals/meas_MID00074_FID06172_diffSpiral_508_Intl1_b2k_4Avg.mrd&quot;,&quot;Spirals/meas_MID00076_FID06174_diffSpiral_508_Intl2_b2k_4Avg.mrd&quot;,&quot;Spirals/meas_MID00078_FID06176_diffSpiral_508_Intl3_b2k_4Avg.mrd&quot;]

params_general[:scan_filename_stem] = &quot;meas_MID00072_FID06170_diffSpiral_508_Intl0_b2k_4Avg.mrd&quot; # Main file name when saving the result
params_general[:processed_map_scan_filename] = &quot;processed_cartesian_data.h5&quot; # file name for preprocessed data (remove oversampling, permute dimensions wrt MRIReco) [Output]
params_general[:map_save_filename] = splitext(params_general[:map_scan_filename_stem])[1] * &quot;_reconmap.nii&quot; # File name for reconstructed dual-echo Cartesian images [Output]
params_general[:sensitivity_save_filename] = splitext(params_general[:map_scan_filename_stem])[1] * &quot;_sensemap.nii&quot; # File name for calculated coil sensitivity maps [Output]
params_general[:b0_map_save_filename] = splitext(params_general[:map_scan_filename_stem])[1] * &quot;_b0map.nii&quot;; # File name for calculated off-resonance (B₀) maps [Output]</code></pre><p>File name for the final reconstructed spiral image. If we reconstructing multiple spiral data files (e.g. multiple interleaves) through <code>RunReconLoop.jl</code>, the file name for the final reconstructed image is concatenated from multiple scan file names. Otherwise, just append <code>_recon.nii</code> as suffix to file name.</p><pre><code class="language-julia hljs">if isa(params_general[:scan_filename], AbstractVector)
    params_general[:recon_save_filename] =
        join([(x[1] * &quot;_&quot;) for x in splitext.(params_general[:scan_filename_stem])]) *
        &quot;dif$(selector[:dif])_&quot; *
        &quot;itl$(selector[:seg])_&quot; *
        &quot;avg$(selector[:avg])_&quot; *
        &quot;recon.nii&quot;;
else
    params_general[:recon_save_filename] = splitext(params_general[:scan_filename_stem])[1] * &quot;_recon.nii&quot;;
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;m_._dif0_itl1_avg1_recon.nii&quot;</code></pre><h3 id="Assembling-Full-Paths"><a class="docs-heading-anchor" href="#Assembling-Full-Paths">Assembling Full Paths</a><a id="Assembling-Full-Paths-1"></a><a class="docs-heading-anchor-permalink" href="#Assembling-Full-Paths" title="Permalink"></a></h3><p>Assembling directories and file names for final full pathes. These are automated operations.</p><pre><code class="language- hljs">params_general[:gradient_fullpath] = joinpath(params_general[:gradients_path], params_general[:gradient_filename]) # Full paths of spiral readout gradients
params_general[:girf_fullpath] = joinpath.(params_general[:girf_path], params_general[:girf_filename]) # Full paths of GIRF files
params_general[:map_scan_fullpath] = joinpath(params_general[:data_path], params_general[:map_scan_filename]) # Full path of dual-echo Cartesian data
params_general[:scan_fullpath] = joinpath.(params_general[:data_path], params_general[:scan_filename]) # Full paths of raw k-space data files of spiral acquisition
params_general[:processed_map_scan_fullpath] = joinpath(params_general[:recon_save_path], params_general[:processed_map_scan_filename]) # Full paths of pre-processed Cartesian dual-echo data [Output]
params_general[:recon_save_fullpath] = joinpath(params_general[:recon_save_path], params_general[:recon_save_filename]) # Full paths of the reconstructed spiral image [Output]
params_general[:map_save_fullpath] = joinpath(params_general[:recon_save_path], params_general[:map_save_filename]) # Full paths of reconstructed dual-echo Cartesian images [Output]
params_general[:sensitivity_save_fullpath] = joinpath(params_general[:recon_save_path], params_general[:sensitivity_save_filename]) # Full paths of calculated coil sensitivity maps [Output]
params_general[:b0_map_save_fullpath] = joinpath(params_general[:recon_save_path], params_general[:b0_map_save_filename]); # Full paths of calculated off-resonance (B₀) maps [Output]
nothing #hide</code></pre><h2 id="Final-Steps"><a class="docs-heading-anchor" href="#Final-Steps">Final Steps</a><a id="Final-Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Final-Steps" title="Permalink"></a></h2><p>Optional: If the path for results writing is not existing, create it.</p><p>As the last step of configuration, copy this config file to the recon path for further checking and debugging purposes.</p><pre><code class="language- hljs">if ~ispath(params_general[:recon_save_path])
    mkpath(params_general[:recon_save_path])
end

cp(@__FILE__, joinpath(params_general[:recon_save_path], &quot;recon_config.jl&quot;); force = true)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../joss_demo/">« GIRFReco.jl Example Script</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 24 July 2025 21:39">Thursday 24 July 2025</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
